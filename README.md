
# dotfiles

Welcome to my dotfiles repo.  I use `chezmoi` to manage my home directory, 
synchronize application settins, and install packages on my computers.

# Setting up a new environment

  1. Make sure the environment has git, ssh, and the appropriate package
     manager.  In general these days this is already true in most of the
     environments I use, but there are occasional exceptions.

  2. Make an ssh key-- `ssh-keygen`-- and upload it to github 

  3. Install `chezmoi` and have it apply my dotfiles repository from github. 
     This installs a set of packages, which depend on the OS I'm running on.
     (The "installing the right set of packages" part is a work in progress,
     as discussed [below](#package-management)).

     In Linux: 
     `sh -c "$(curl -fsLS get.chezmoi.io)" -- init --apply git@github.com:dchaploeb/dotfiles.git` 

     or in powershell:
     `iex "&{$(irm 'https://get.chezmoi.io/ps1')} -- init --apply git@github.com:dchaploeb/dotfiles.git"` 
     (TODO: test this; it didn't work last time I tried it but I think I had 
     the quotes in the wrong place.  If it doesn't work, big whoop, install
     first and then init and apply.  What, you're only happy if it's a
     single line of code?)
 
  4. Tweak settings in `~/.config/chezmoi/chezmoi.toml` to specify which
     sets of packages `chezmoi` should install.  If anything was changed,
     run `chezmoi apply` again to install them.

  5. Install packages manually if needed.  Right now, some of the packages get 
     installed by running scripts which live in `bin/` and some packages I use
     regularly aren't supported by my `cheezmoi apply` workflow yet.  
     I try not to install anything with a gui installer-- as noted, 
     I want reproducible processes, and downloading an installer and double
     clicking on it is not that!  So the goal is that this step eventually
     doesn't exist.  (`syncthing` is currently a semi-manual setup)

  6. Set up additional sync services.  There are too many of these.  I keep
     trying to consolidate down but each service has benefits and limitations.
     `syncthing` is a recent addition to this and may end up replacing some of
     the cloud services.
     1. syncthing
     2. Proton Drive
     3. vscode sync
     4. Obsidian sync
     5. iCloud
     6. Google Drive.
     7. OneDrive

That's it!  Everything I need is installed, my data is synced and configured the way I like it at this point.  
Of course, steps 5 and 6 still involve some manual work, but it's a lot less than was needed in the past.

# chezmoi workflow

This is how I use `chezmoi`.

I have auto-commit and auto-push turned on.  Both zsh and powershell are 
set to run chezmoi update and chezmoi apply at login.  After editing a dotfile 
in my home directory or changing settings that I want to keep synced, I run
`chezmoi re-add`, which picks up the change, commits it, and pushes it to
github.   

Editorial comment: `chezmoi re-add` turns out to be the command that makes 
`chezmoi` really a
time-saver for me.  When I read people complaining about `chezmoi` on the web,
it's the process of editing files in the chezmoi directory rather than where
they're being used that turns people off.  For the most part, you don't have 
to do this.  Edit files that have been added to chezmoi in-place, then run
`chezmoi re-add`.

For dotfiles, the exception to this is files generated by chezmoi templates.
If you're using this feature, changing those files means editing the 
templates in the chezmoi directory.  This is a tradeoff-- the template allows 
me to maintain one file which modifies itself based on environment, but in 
order to make  that work I have to edit the template rather than the real 
file.  If a file needs this treatment, use `chezmoi add --template` to convert 
it to a template.

And of course, chezmoi scripts and config files live in the chezmoi
directory and get edited there.

For easy access to scripts and templates, I have chezmoi create a symlink at 
`~/chezmoi` pointing to `~/.local/share/chezmoi`.  This allows me to easily 
switch to the directory, or open it in vscode with `code chezmoi`

After editing stuff in the chezmoi directory, I still just run `chezmoi re-add`
and that triggers chezmoi to commit and push my changes.

I don't currently use chezmoi's password manager integration, though it looks
pretty neat.

# Functionality (and desired functionality)

## Dotfiles, Profiles, and Preferences

 - ✅ Sync .gitconfig
 - ✅ Sync zsh dotfiles
 - ✅ Sync powershell profile:  The Powershell profile installs to all of 
      the places it might be needed (4 of them, at the moment; there will be 
      one more if I start using pwsh on linux).  Because this multi-install 
      makes running the actual $PROFILE file awkward, I now use a profile
      directory and run everything in it, which honestly seems better anyway. 
      In the rare event that I need to edit the actual profile script, the
      editable version of that lives at 
      `~/chezmoi/.chezmoitemplates/Microsoft.PowerShell_profile.ps1.tmpl`
 - ✅ Sync Windows Terminal Settings
 - ✅ Sync icons for use with windows terminal.
 - ✅ Sync my custom `retrobar` theme and settings on Windows
 - TODO: set editor to something other than `code` on systems accessed via 
   `ssh`
 
## Scripts and aliases
 - ✅ On windows, my defines a unix-like `ls` function and a useful `Add-ToPath` function
 - ✅ Python convert_png_to_ico.py (works!)
 - TODO: More to come from dev environments.

## Package management

 -  ✅ Install needed packages on linux
 -  ✅ Install zsh and set it to be my shell.
 -  TODO: Finish winget package installation (this might be done)
 -  TODO: Fix powershell module installation (this might be done)
 -  TODO: Move as many `bin/` install scripts as possible to actual scripts run 
    by `chezmoi`.

## Start Menus, bars, launchers, and Web Shortcuts (on Windows)

 - ✅ Sync Retrobar theme and prefs
 - ✅ Sync yasb theme and prefs
 - ✅ Build and install Web shortcuts
 - TODO: Window management tool prefs, once I have a stable configuration

The web shortcuts feature is my favorite thing in here and deserves some comment:

I make pretty heavy use of Brave Browser's "application" shortcuts, which
install into the start menu.  (You could do something similar with any
chromium-based browser).  But those "applications" aren't easily syncable 
between computers, nor is there a simple way to script making the browser 
create them.  So I created an alternative.

(It would be nice if my alternative worked in any desktop environment, but
that's a distant TODO.  For now I'm constructing Windows shortcuts.)

This is working now; the system will build shortcuts for me based on a config file
and put them in a start menu folder, updating them as needed.  Still some tweaks
to this to come, but it's a working feature (and should be adaptable to any
Chromium-based browser that supports application shortcuts).

# Wishlist and Works in Progress

This part of the file really isn't about dotfiles or this repository, it's
about tools I want to find or set up.  If you know of anything that fills in
these blanks, please let me know!

 - WINDOWS LAUNCHER: Currently I use Start11 to create a 
   Windows 10 style Start menu.  This is great, and makes Windows usable for me.
   (If you hate the Windows 10 start menu, that's cool.  It took me a while to
   warm up to it, but once I did, Windows 11's made me really sad in how
   inflexible it is).  But it isn't really something that can be built in an
   automated way, either with Windows or Start11, for a variety of reasons.  So
   a config-based launcher is something I'd love to have.  Also
   I have a strong preference for open source tools, especially UI stuff like this.  It 
   doesn't need to look *exactly* like the Windows 10 start menu, but it needs to 
   have many of the same features.  So far all of the tools I can find either 
   don't really meet my needs (Open Shell, Cairo) or are commercial (Start11, 
   StartAllBack, Start Menu Reviver).  If you know of something else I should try,
   let me know! Right now I'm fooling with `yasb` and I might build menus that go there.  
   That would do everything I need, but I'd miss my big colorful app icons.
 - WINDOW MANAGER FOR WINDOWS: I've been messing with various methods of window management on Windows. 
I've tried a bunch of window managers.  Right now I'm leaning towards 
using the built-in Windows multi-desktop management, enhanced with `yasb` 
for quick switching using the mouse and the FancyZones and Workspaces 
Powertoys.  So
you may see some of that in my dotfiles.  I've also been fooling with 
`glazewm` a bit; I like the way it handles multiple monitors better than 
most other window managers but it annoys me in other ways. I also just found
`windows-terminal-quake`.  Contrary to the name,
it supports slide-out quake-style windows for more than just Windows 
Terminal (in fact, I'm not using it for Windows Terminal!) Config for that is still being fooled with, so it's not checked in yet,
but it will be here soon.
- I use Obsidian, but its licensing model bugs me.  There's nothing else quite
  like it out there, but I keep my eyes open.  (I have enough in Obsidian now
  that dealing with a large collection of markdown-based files is a feature
  requirement).
- A good FOSS spreadsheet.  Closed-source Desktop applications from large
companies are often pretty terrible-- I'm looking at you, Adobe-- but 
spreadsheet software is an exception.  Excel and Google Sheets are both 
really good products; they both get active feature development and leapfrog 
each other in capabilities regularly.  It would be really nice if the open 
source world had something nearly as good.  It does not.  Yes, I have tried
LibreOffice. Repeatedly.  For years.

